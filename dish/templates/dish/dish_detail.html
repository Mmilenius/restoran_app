{% extends "includes/base.html" %}
{% load static %}

{% block content %}
<!-- Dish Detail Modal-like Container -->
<div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
    <div style="background: white; border-radius: 12px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; position: relative;">
        
        <!-- Close Button -->
        <button onclick="window.history.back()" style="position: absolute; top: 15px; right: 15px; background: #FF5722; color: white; border: none; border-radius: 50%; width: 35px; height: 35px; font-size: 18px; cursor: pointer; z-index: 10;">
            ‚úï
        </button>

        <!-- Dish Image -->
        <div style="position: relative;">
            {% if dish.image %}
            <img src="{{ dish.image.url }}" alt="{{ dish.name }}" style="width: 100%; height: 300px; object-fit: cover; border-radius: 12px 12px 0 0;">
            {% else %}
            <img src="{% static 'images/no-image.jpg' %}" alt="{{ dish.name }}" style="width: 100%; height: 300px; object-fit: cover; border-radius: 12px 12px 0 0;">
            {% endif %}
            
            {% if dish.is_new %}
            <span style="position: absolute; top: 15px; left: 15px; background: #28a745; color: white; font-size: 12px; padding: 4px 8px; border-radius: 6px; font-weight: 600;">–ù–û–í–ò–ù–ö–ê</span>
            {% endif %}
            
            {% if dish.discount_percentage %}
            <span style="position: absolute; top: 15px; right: 50px; background: #FF5722; color: white; font-size: 12px; padding: 4px 8px; border-radius: 6px; font-weight: 600;">-{{ dish.discount_percentage }}%</span>
            {% endif %}
        </div>

        <!-- Dish Content -->
        <div style="padding: 24px;">
            <!-- Dish Header -->
            <div style="margin-bottom: 20px;">
                <h1 style="font-size: 28px; font-weight: 700; color: #2c3e50; margin-bottom: 8px;">{{ dish.name }}</h1>
                <p style="color: #6c757d; font-size: 16px; line-height: 1.6; margin-bottom: 16px;">{{ dish.description }}</p>
                
                {% if dish.ingredients %}
                <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                    <p style="color: #495057; font-size: 14px; font-style: italic; margin: 0;">
                        <strong>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</strong> {{ dish.ingredients }}
                    </p>
                </div>
                {% endif %}
            </div>

            <!-- Dish Meta Information -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 24px;">
                <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 20px; margin-bottom: 4px;">üçΩÔ∏è</div>
                    <div style="font-size: 14px; color: #6c757d;">–í–∞–≥–∞</div>
                    <div style="font-weight: 600; color: #2c3e50;">{{ dish.weight }}–≥</div>
                </div>

                {#{% if dish.calories %}
                <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 20px; margin-bottom: 4px;">üî•</div>
                    <div style="font-size: 14px; color: #6c757d;">–ö–∞–ª–æ—Ä—ñ—ó</div>
                    <div style="font-weight: 600; color: #2c3e50;">{{ dish.calories }} –∫–∫–∞–ª</div>
                </div>
                {% endif %}
                
                {% if dish.cooking_time %}
                <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 20px; margin-bottom: 4px;">‚è±Ô∏è</div>
                    <div style="font-size: 14px; color: #6c757d;">–ß–∞—Å –≥–æ—Ç—É–≤–∞–Ω–Ω—è</div>
                    <div style="font-weight: 600; color: #2c3e50;">{{ dish.cooking_time }} —Ö–≤</div>
                </div>
                {% endif %}#}

                <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 20px; margin-bottom: 4px;">üìÇ</div>
                    <div style="font-size: 14px; color: #6c757d;">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</div>
                    <div style="font-weight: 600; color: #2c3e50;">{{ dish.category.name }}</div>
                </div>
            </div>

            <!-- Likes and Share -->
            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 24px; padding: 16px; background: #f8f9fa; border-radius: 8px;">
                <div style="display: flex; align-items: center; gap: 8px; cursor: pointer;" data-dish-id="{{ dish.id }}">
                    <span style="font-size: 18px;">‚ù§Ô∏è</span>
                    <span style="color: #6c757d; font-weight: 500;">{{ dish.likes }} –≤–ø–æ–¥–æ–±–∞–Ω—å</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <span style="font-size: 18px;">üì§</span>
                    <span style="color: #6c757d; font-weight: 500;">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è</span>
                </div>
            </div>

            <!-- Price and Add to Cart -->
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 20px; background: #f8f9fa; border-radius: 12px; margin-bottom: 24px;">
                <div>
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                        <span style="font-size: 32px; font-weight: 700; color: #FF5722;">{{ dish.price }} ‚Ç¥</span>
                        {% if dish.old_price %}
                        <span style="font-size: 20px; color: #6c757d; text-decoration: line-through;">{{ dish.old_price }} ‚Ç¥</span>
                        {% endif %}
                    </div>
                    {% if dish.discount_percentage %}
                    <div style="color: #28a745; font-weight: 600; font-size: 14px;">–ï–∫–æ–Ω–æ–º—ñ—è {{ dish.old_price|floatformat:0|add:"-"|add:dish.price|floatformat:0 }} ‚Ç¥</div>
                    {% endif %}
                </div>

                <!-- Quantity Controls -->
                <div style="display: flex; align-items: center; gap: 16px;">
                    <div style="display: flex; align-items: center; border: 2px solid #e9ecef; border-radius: 8px;">
                        <button style="background: none; border: none; padding: 10px 12px; cursor: pointer; font-size: 18px; color: #FF5722;" onclick="decreaseQuantity()">‚àí</button>
                        <span id="quantity" style="padding: 10px 16px; font-weight: 600; min-width: 40px; text-align: center;">1</span>
                        <button style="background: none; border: none; padding: 10px 12px; cursor: pointer; font-size: 18px; color: #FF5722;" onclick="increaseQuantity()">+</button>
                    </div>
                    
                    <button class="add-btn" data-dish-id="{{ dish.id }}" style="padding: 12px 24px; font-size: 16px;">
                        –î–æ–¥–∞—Ç–∏ <span id="total-price">{{ dish.price }}</span> ‚Ç¥
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let quantity = 1;
const basePrice = {{ dish.price }};

function increaseQuantity() {
    quantity++;
    updateQuantityDisplay();
}

function decreaseQuantity() {
    if (quantity > 1) {
        quantity--;
        updateQuantityDisplay();
    }
}

function updateQuantityDisplay() {
    document.getElementById('quantity').textContent = quantity;
    document.getElementById('total-price').textContent = (basePrice * quantity).toFixed(0);
}

// Close on Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        window.history.back();
    }
});

// Close on background click
document.addEventListener('click', function(e) {
    if (e.target.style.position === 'fixed') {
        window.history.back();
    }
});
</script>

{% endblock %}